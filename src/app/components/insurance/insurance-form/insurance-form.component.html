<!-- <form [formGroup]="insuranceForm" (ngSubmit)="onSubmit()" class="d-flex flex-column container-fluid container-md">
    @if(insuranceId){
        <h2 class="text-center">Edit Insurance</h2>
    }
    @else{
        <h2 class="text-center">Add Insurance</h2>
    }

    <mat-form-field class="mb-3">
        <mat-label>Insurer</mat-label>
        <input matInput type="text" formControlName="insurer" placeholder="Insurer Name">
        <mat-error *ngIf="insuranceForm.get('insurer')?.hasError('required')">Insurer is required</mat-error>
      </mat-form-field>
      
      <mat-form-field class="mb-3">
        <mat-label>Type of Insurance</mat-label>
        <input matInput type="text" formControlName="type_of_insurance" placeholder="Type of Insurance">
        <mat-error *ngIf="insuranceForm.get('type_of_insurance')?.hasError('required')">Type of Insurance is required</mat-error>
      </mat-form-field>
      
      <mat-form-field class="mb-3">
        <mat-label>Service</mat-label>
        <input matInput type="text" formControlName="service" placeholder="Service">
        <mat-error *ngIf="insuranceForm.get('service')?.hasError('required')">Service is required</mat-error>
      </mat-form-field>
      
      <mat-form-field class="mb-3">
        <mat-label>Policy Number</mat-label>
        <input matInput type="text" formControlName="policy_number" placeholder="Policy Number">
        <mat-error *ngIf="insuranceForm.get('policy_number')?.hasError('required')">Policy Number is required</mat-error>
      </mat-form-field>

      <mat-form-field class="mb-3">
        <mat-label>Date of Contract Conclusion</mat-label>
        <input matInput [matDatepicker]="contractDatePicker" formControlName="date_of_contract_conclusion">
        <mat-datepicker-toggle matIconSuffix [for]="contractDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #contractDatePicker></mat-datepicker>
        <mat-error *ngIf="insuranceForm.get('date_of_contract_conclusion')?.hasError('required')">
          Technical inspection date is required
        </mat-error>
      </mat-form-field>



      <mat-form-field class="mb-3">
        <mat-label>Start of Insurance</mat-label>
        <input matInput [matDatepicker]="startDatePicker" formControlName="start_of_insurance">
        <mat-datepicker-toggle matIconSuffix [for]="startDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #startDatePicker></mat-datepicker>
        <mat-error *ngIf="insuranceForm.get('start_of_insurance')?.hasError('required')">
          Technical inspection date is required
        </mat-error>
      </mat-form-field>
      
      <mat-form-field class="mb-3">
        <mat-label>End of Insurance</mat-label>
        <input matInput [matDatepicker]="endDatePicker" formControlName="end_of_insurance">
        <mat-datepicker-toggle matIconSuffix [for]="endDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #endDatePicker></mat-datepicker>
        <mat-error *ngIf="insuranceForm.get('end_of_insurance')?.hasError('required')">
          Technical inspection date is required
        </mat-error>
      </mat-form-field>

      
      <mat-form-field class="mb-3">
        <mat-label>Phone Number to Call</mat-label>
        <input matInput type="text" formControlName="phone_number_to_call" placeholder="Phone Number (e.g. 12 345 678 910)">
        <mat-error *ngIf="insuranceForm.get('phone_number_to_call')?.hasError('required')">Phone number is required</mat-error>
        <mat-error *ngIf="insuranceForm.get('phone_number_to_call')?.hasError('pattern')">Invalid phone number format</mat-error>
      </mat-form-field>
      <button mat-raised-button color="primary" type="submit" [disabled]="insuranceForm.invalid">
        Submit
      </button>
    
  </form> -->

  <form [formGroup]="insuranceForm" (ngSubmit)="onSubmit()" class="d-flex flex-column container-fluid container-md">
    <h2 class="text-center">{{isEditing ? 'Edit' : 'Add'}} Insurance</h2>

    <div *ngIf="loading" class="text-center my-4">
        <span>Loading...</span>
    </div>

    <ng-container *ngIf="!loading">
        <mat-form-field class="mb-3">
            <mat-label>Insurer</mat-label>
            <input matInput type="text" formControlName="insurer" placeholder="Insurer Name">
            <mat-error *ngIf="insuranceForm.get('insurer')?.hasError('required')">Insurer is required</mat-error>
        </mat-form-field>

        <mat-form-field class="mb-3">
            <mat-label>Type of Insurance</mat-label>
            <input matInput type="text" formControlName="typeOfInsurance" placeholder="Type of Insurance">
            <mat-error *ngIf="insuranceForm.get('typeOfInsurance')?.hasError('required')">Type of Insurance is required</mat-error>
        </mat-form-field>

        <mat-form-field class="mb-3">
            <mat-label>Service</mat-label>
            <input matInput type="text" formControlName="service" placeholder="Service">
            <mat-error *ngIf="insuranceForm.get('service')?.hasError('required')">Service is required</mat-error>
        </mat-form-field>

        <mat-form-field class="mb-3">
            <mat-label>Policy Number</mat-label>
            <input matInput type="text" formControlName="policyNumber" placeholder="Policy Number">
            <mat-error *ngIf="insuranceForm.get('policyNumber')?.hasError('required')">Policy Number is required</mat-error>
        </mat-form-field>

        <mat-form-field class="mb-3">
            <mat-label>Date of Contract Conclusion</mat-label>
            <input matInput [matDatepicker]="contractDatePicker" formControlName="dateOfContractConclusion">
            <mat-datepicker-toggle matIconSuffix [for]="contractDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #contractDatePicker></mat-datepicker>
            <mat-error *ngIf="insuranceForm.get('dateOfContractConclusion')?.hasError('required')">
                Contract conclusion date is required
            </mat-error>
        </mat-form-field>

        <mat-form-field class="mb-3">
            <mat-label>Start of Insurance</mat-label>
            <input matInput [matDatepicker]="startDatePicker" formControlName="startOfInsurance">
            <mat-datepicker-toggle matIconSuffix [for]="startDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #startDatePicker></mat-datepicker>
            <mat-error *ngIf="insuranceForm.get('startOfInsurance')?.hasError('required')">
                Start date is required
            </mat-error>
        </mat-form-field>

        <mat-form-field class="mb-3">
            <mat-label>End of Insurance</mat-label>
            <input matInput [matDatepicker]="endDatePicker" formControlName="endOfInsurance">
            <mat-datepicker-toggle matIconSuffix [for]="endDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #endDatePicker></mat-datepicker>
            <mat-error *ngIf="insuranceForm.get('endOfInsurance')?.hasError('required')">
                End date is required
            </mat-error>
        </mat-form-field>

        <mat-form-field class="mb-3">
            <mat-label>Phone Number to Call</mat-label>
            <input matInput type="text" formControlName="phoneNumberToCall" placeholder="Phone Number (e.g. 12 345 678 910)">
            <mat-error *ngIf="insuranceForm.get('phoneNumberToCall')?.hasError('required')">Phone number is required</mat-error>
            <mat-error *ngIf="insuranceForm.get('phoneNumberToCall')?.hasError('pattern')">Invalid phone number format</mat-error>
        </mat-form-field>

        <div class="d-flex gap-2">
            <button mat-raised-button color="primary" type="submit" [disabled]="insuranceForm.invalid || loading">
                {{isEditing ? 'Update' : 'Save'}}
            </button>
            <button mat-button type="button" [routerLink]="['/insurance', carId]">
                Cancel
            </button>
        </div>
    </ng-container>
</form>